<!-- templates/instructor/dashboard.html -->
{% extends 'instructor_base.html' %}

{% block title %}Instructor Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="welcome-card">
                <h2>Welcome back, {{ user.get_full_name|default:user.username }}!</h2>
                <p class="mb-0">Manage your courses, students, and content from your instructor dashboard.</p>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <div class="stats-number">{{ total_courses }}</div>
                <div class="stats-label">My Courses</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <div class="stats-number">{{ total_students }}</div>
                <div class="stats-label">Total Students</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <div class="stats-number">{{ permissions.count }}</div>
                <div class="stats-label">Permissions</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <div class="stats-number">{{ recent_enrollments.count }}</div>
                <div class="stats-label">New Enrollments</div>
            </div>
        </div>
    </div>

    <!-- Permission Status -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-shield-alt me-2"></i>Your Permissions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="permission-item {% if has_course_permission %}granted{% else %}denied{% endif %}">
                                <i class="fas fa-book me-2"></i>
                                Course Management
                                {% if has_course_permission %}
                                <span class="badge bg-success ms-2">Granted</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Not Granted</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="permission-item {% if has_content_permission %}granted{% else %}denied{% endif %}">
                                <i class="fas fa-file-alt me-2"></i>
                                Content Management
                                {% if has_content_permission %}
                                <span class="badge bg-success ms-2">Granted</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Not Granted</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="permission-item {% if has_batch_permission %}granted{% else %}denied{% endif %}">
                                <i class="fas fa-layer-group me-2"></i>
                                Batch Management
                                {% if has_batch_permission %}
                                <span class="badge bg-success ms-2">Granted</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Not Granted</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="permission-item {% if has_student_permission %}granted{% else %}denied{% endif %}">
                                <i class="fas fa-user-graduate me-2"></i>
                                Student Management
                                {% if has_student_permission %}
                                <span class="badge bg-success ms-2">Granted</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Not Granted</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="permission-item {% if has_email_permission %}granted{% else %}denied{% endif %}">
                                <i class="fas fa-envelope me-2"></i>
                                Email Marketing
                                {% if has_email_permission %}
                                <span class="badge bg-success ms-2">Granted</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Not Granted</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="permission-item {% if has_analytics_permission %}granted{% else %}denied{% endif %}">
                                <i class="fas fa-chart-bar me-2"></i>
                                Analytics View
                                {% if has_analytics_permission %}
                                <span class="badge bg-success ms-2">Granted</span>
                                {% else %}
                                <span class="badge bg-danger ms-2">Not Granted</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    {% if not has_course_permission and not has_content_permission and not has_batch_permission %}
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Limited Access:</strong> Contact your administrator to get permissions for managing courses and content.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    {% if has_course_permission %}
<a href="{% url 'instructor_courses' %}" class="btn btn-primary btn-sm mb-2 me-2">
                        <i class="fas fa-book me-1"></i>Manage Courses
                    </a>
                    {% endif %}
                    
                    {% if has_content_permission %}
<a href="{% url 'content_management' %}" class="btn btn-success btn-sm mb-2 me-2">
                        <i class="fas fa-file-alt me-1"></i>Manage Content
                    </a>
                    {% endif %}
                    
                    {% if has_student_permission %}
                    <a href="{% url 'student_management' %}" class="btn btn-info btn-sm mb-2 me-2">

                    {% endif %}
                    
                    {% if has_email_permission %}
                   <a href="{% url 'email_marketing' %}" class="btn btn-warning btn-sm mb-2 me-2">

                        <i class="fas fa-envelope me-1"></i>Send Emails
                    </a>
                    {% endif %}
                    
                    {% if not has_course_permission and not has_content_permission and not has_student_permission and not has_email_permission %}
                    <p class="text-muted mb-0">No quick actions available. Contact admin for permissions.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-graduation-cap me-2"></i>My Courses</h5>
                </div>
                <div class="card-body">
                    {% if instructor_courses %}
                    <div class="list-group list-group-flush">
                        {% for course in instructor_courses %}
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">{{ course.title }}</h6>
                                    <small class="text-muted">{{ course.course_code }}</small>
                                </div>
                                <span class="badge bg-primary">{{ course.get_enrolled_count }} students</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted mb-0">No courses assigned yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Enrollments -->
    {% if recent_enrollments %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-user-plus me-2"></i>Recent Enrollments</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Course</th>
                                    <th>Enrolled Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for enrollment in recent_enrollments %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle me-2">
                                                {{ enrollment.student.first_name|first }}{{ enrollment.student.last_name|first }}
                                            </div>
                                            {{ enrollment.student.get_full_name|default:enrollment.student.username }}
                                        </div>
                                    </td>
                                    <td>{{ enrollment.course.title }}</td>
                                    <td>{{ enrollment.enrolled_at|date:"M d, Y" }}</td>
                                    <td>
                                        <span class="badge bg-success">{{ enrollment.get_status_display }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.welcome-card {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);
}

.stats-card {
    background: white;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.stats-card:hover {
    transform: translateY(-5px);
}

.stats-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.stats-label {
    color: #6b7280;
    font-size: 0.9rem;
    text-transform: uppercase;
    font-weight: 600;
}

.permission-item {
    padding: 10px;
    border-radius: 8px;
    background: #f8fafc;
    border-left: 4px solid #e5e7eb;
}

.permission-item.granted {
    background: #f0fdf4;
    border-left-color: #10b981;
}

.permission-item.denied {
    background: #fef2f2;
    border-left-color: #ef4444;
}

.avatar-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.8rem;
}
</style>
{% endblock %}